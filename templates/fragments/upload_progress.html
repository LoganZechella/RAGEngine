<div class="bg-gray-700 rounded-lg p-4" hx-ext="sse" hx-sse="connect:/progress/{{ task_id }}">
    <h4 class="font-semibold text-white mb-3">üì§ Upload Progress</h4>
    
    <div class="space-y-3">
        <!-- Progress Bar -->
        <div class="relative">
            <div class="w-full bg-gray-600 rounded-full h-2">
                <div 
                    class="bg-blue-600 h-2 rounded-full progress-bar transition-all duration-300" 
                    style="width: 0%"
                    hx-sse="swap:message"
                    hx-swap="none"
                    hx-trigger="sse:message"
                    _="on sse:message 
                       set data to JSON.parse(event.data)
                       set my style.width to data.progress + '%'
                       if data.progress >= 100
                         if data.status == 'error'
                           add .bg-red-600 to me
                           remove .bg-blue-600 from me
                         else
                           add .bg-green-600 to me
                           remove .bg-blue-600 from me
                         end
                       end"
                ></div>
            </div>
            <div class="flex justify-between text-sm text-gray-400 mt-1">
                <span 
                    hx-sse="swap:message"
                    hx-trigger="sse:message"
                    _="on sse:message 
                       set data to JSON.parse(event.data)
                       put data.message into me"
                >Preparing...</span>
                <span 
                    hx-sse="swap:message"
                    hx-trigger="sse:message"
                    _="on sse:message 
                       set data to JSON.parse(event.data)
                       put data.progress + '%' into me"
                >0%</span>
            </div>
        </div>
        
        <!-- Status Messages -->
        <div 
            class="text-sm text-gray-300"
            hx-sse="swap:message"
            hx-trigger="sse:message"
            _="on sse:message 
               set data to JSON.parse(event.data)
               if data.status == 'completed'
                 add .text-green-400 to me
                 put '‚úÖ ' + data.message into me
               else if data.status == 'error'
                 add .text-red-400 to me
                 put '‚ùå ' + data.message into me
               else
                 put '‚è≥ ' + data.message into me
               end"
        >
            Preparing upload...
        </div>
        
        <!-- Collection Assignments (shown on completion) -->
        <div 
            class="collection-assignments hidden text-sm"
            hx-sse="swap:message"
            hx-trigger="sse:message"
            _="on sse:message 
               set data to JSON.parse(event.data)
               if data.status == 'completed' and data.collection_assignments
                 set html to '<div class=\"bg-gray-800 rounded p-3 mt-2\"><h5 class=\"text-white font-medium mb-2\">üìÅ Document Assignments:</h5>'
                 for file in Object.keys(data.collection_assignments)
                   set collection to data.collection_assignments[file]
                   set html to html + '<div class=\"text-xs text-gray-300 mb-1\"><span class=\"text-blue-400\">' + file + '</span> ‚Üí <span class=\"text-green-400\">' + collection + '</span></div>'
                 end
                 set html to html + '</div>'
                 put html into me
                 remove .hidden from me
               end"
        >
        </div>
        
        <!-- Error Messages -->
        <div 
            class="error-messages text-sm"
            hx-sse="swap:message"
            hx-trigger="sse:message"
            _="on sse:message 
               set data to JSON.parse(event.data)
               if data.errors and data.errors.length > 0
                 set errorHtml to '<div class=\"bg-red-900 bg-opacity-50 rounded p-3 mt-2\"><h5 class=\"text-red-300 font-medium mb-2\">‚ö†Ô∏è Errors:</h5>'
                 for error in data.errors
                   set errorHtml to errorHtml + '<div class=\"text-red-400 text-xs mb-1\">‚Ä¢ ' + error + '</div>'
                 end
                 set errorHtml to errorHtml + '</div>'
                 put errorHtml into me
               end"
        >
        </div>
    </div>
</div>

<script src="https://unpkg.com/hyperscript.org@0.9.12"></script> 